/*!
 * jquery.instagramFeed
 *
 * @version 1.2
 *
 * @author Javier Sanahuja Liebana <bannss1@gmail.com>
 *
 * https://github.com/jsanahuja/jquery.instagramFeed
 *
 */

(function($){
	var defaults = {
		'host': "https://www.instagram.com/",
		'username': '',
		'container': '',
		'display_profile': true,
		'display_biography': true,
		'display_gallery': true,
		'get_raw_json': false,
		'callback': null,
		'styling': true,
		'items': 100,
		'items_per_row': 3,
		'margin': 20
	};

	$.instagramFeed = function(options){
		options = $.fn.extend({}, defaults, options);
		if(options.username == ""){
			console.error("Instagram Feed: Error, no username found.");
			return;
		}	
		if(!options.get_raw_json && options.container == ""){
			console.error("Instagram Feed: Error, no container found.");
			return;
		}
		if(options.get_raw_json && options.callback == null){
			console.error("Instagram Feed: Error, no callback defined to get the raw json");
			return;
		}

		$.get(options.host + 'tags/Ora2me超有型', function(data){
				data = data.split("window._sharedData = ");
				data = data[1].split("<\/script>");
				data = data[0];
				data = data.substr(0, data.length - 1);
				data = JSON.parse(data);
				data = data.entry_data.TagPage[0].graphql.hashtag.edge_hashtag_to_media.edges;
				
				if(options.get_raw_json){
					options.callback(JSON.stringify({
						id: data.id,
						username: data.username,
						full_name: data.full_name,
						is_private: data.is_private,
						is_verified: data.is_verified,
						biography: data.biography,
						followed_by: data.edge_followed_by.count,
						following: data.edge_follow.count,
						'images': data.edge_owner_to_timeline_media.edges,
					}));
					return;
				}
				
				var styles = {
					'profile_container': "",
					'profile_image': "",
					'profile_name': "",
					'profile_biography': "",
					'gallery_image': ""
				};
				var html = '';
				var htmlTwo = '';
				var btn ='';
				var btn2='';
				var htmlThree='';
				if(options.display_gallery){
					var max = (data.length > options.items) ? options.items : data.length;
					console.log("max:"+max);

						for(let i=0;i<6;i++){
							var url = "https://www.instagram.com/p/"+ data[i].node.shortcode;
								html += "<a href='"+url+"' target='_blank' >";
								html += "<img src='"+ data[i].node.thumbnail_src +"' alt='"+ options.username +" instagram image "+ i+"'"+styles.gallery_image+"/>";
								html += "</a>";	
						}

					btn=" <input type='button' class='dk_ig_Btn' id='igbtn' value='Load More'>";
					
					// htmlTwo +="<div class='instagram_gallery' style='display:none;' id='htmlTwo'>";
						for(let i=6;i<9;i++){
							var url = "https://www.instagram.com/p/"+ data[i].node.shortcode;
							htmlTwo += "<a href='"+url+"' target='_blank' class='partTwo' style='display:none;'>";
							htmlTwo += "<img src='"+ data[i].node.thumbnail_src +"' alt='"+ options.username +" instagram image "+ i+"'"+styles.gallery_image+"/>";
							htmlTwo += "</a>";	
						}
					// htmlTwo += "</div>";
					btn2="<input type='button' class='dk_ig_Btn' id='igbtnTwo'value='Load More' style='display:none;'>";

					// htmlThree +="<div class='instagram_gallery' style='display:none;' id='htmlThree'>";
						for(let i=12;i<15;i++){
							var url = "https://www.instagram.com/p/"+ data[i].node.shortcode;
							htmlThree += "<a href='"+url+"' target='_blank' class='partThree' style='display:none;'>";
							htmlThree += "<img src='"+ data[i].node.thumbnail_src +"' alt='"+ options.username +" instagram image "+ i+"'"+styles.gallery_image+"/>";
							htmlThree += "</a>";	
						}
				}
					
				$(options.container).html(html+btn+htmlTwo+btn2+htmlThree);

				// $(options.container).html(html);
			}
		);
	};
	
})(jQuery);